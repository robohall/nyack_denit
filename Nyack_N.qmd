---
title: "Denitrification in the Nyack Floodplain Aquifer"
author:
  - name: Robert O. Hall, Jr.
    affiliation: Flathead Lake Bio Station, University of Montana
  - name: Tyler Tappenbeck
    affiliation: Flathead Lake Bio Station, University of Montana
  - name: Geoff Poole
    affiliation: Dept. of Land, Air, and Water Resources, Montana State University
format: 
    pdf
editor: visual
bibliography: references.bib
csl: journal-of-geophysical-research.csl
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
options(scipen = 1, digits = 2)
```

```{r, echo=F, message=FALSE, warning=FALSE}
library(lubridate)
library(readr)
library(tidyverse)
library(lme4)
library(ggplot2)
library(ggExtra)

```

Flathead Lake Biological Station, University of Montana

Dept. of Land, Air, and Water Resources, Montana State University


# Executive Summary

This report summarizes work that fulfills objective 1  in the revised Exploratory 
Proposal entitled ”Scaling hyporheic nitrogen cycling in large river alluvial aquifers,” submitted to and funded by the U.S. Department of Energy (Award DE-SC0019458). As described in the revised proposal, this element was to evaluate N uptake via denitrification at the Nyack floodplain.  Research element 2 was postponed due to a large reduction in project scope.  Research Elements 3 and 4 follow  in a separate paper as part of this overall report.  

Also enclosed in this report is 1.  Poole et al. 2002 a paper describing te basis of the modeling for our current work 10.1371/journal.pone.0262080 and 2.  A  manuscript (Boedecker et al.) that is submitted to Limnology and Oceanography: Methods describing the conditions under which one needs to use a furnace when using a membrane inlet mass spectrometer.  We contributed data collected from this DOE-funded study for this manuscript.


### Abstract for Research Element 1
Denitrification is a difficult flux to measure when fluxes are low and when the ecosystem is difficult to sample.  These attributes describe Nyack floodplain, a large gravel-bedded aquifer adjacent to the Middle Fork Flathead River.  Given that denitrification is simply respiration with nitrate as a terminal electron acceptor, we reasoned that N$_2$ production should negatively covary with oxygen respiration so long that oxygen is available.  We sampled 16 wells 8 times throughout a year and analyzed these water samples on a membrane-inlet mass spectrometer for N$_2$:Ar and O$_2$. We fit multilevel models to N$_2$:Ar as a function of dissolved oxygen.  Within wells, there was no relationship between O$_2$ and N$_2$:Ar.  Among wells N$_2$:Ar increased as O$_2$ declined. Based on the slope of this relationship, ~ -0.07, and estimated oxygen respiration in Nyack derived from prior studies, a possible range for denitrification is 0-8 mmol m-2 d-1 corresponding to a turnover rate for nitrate of 0-0.2/d.  This estimated turnover rate is in the lower 20% of rates measured in the LINX 2 study, yet shows that even in a low nitrate  (0.005 mmol/L) aquifer denitrification can be a substantial sink for dissolved N.




# Introduction

River networks process and transform elements along the continuum from headwaters to the sea. This processing is enough to substantially lower the transported nitrogen (N) load. Given this finding there is much active research into the mechanisms by which streams and rivers can transform, remove, or store N. Headwater streams get the most attention from ecologists in this regard because of evidence showing that they are hot spots of N processing and because they are experimentally tractable. Large rivers have been studied to a much lesser extent, and new theory and data from whole-river N additions show that indeed they are reactive sites for N removal [@ye2017scaling], but we have much less understanding of the role of large rivers at reach or basin scale patterns of riverine nutrient transformations.

Hyporheic zones---the area of interaction between surface water and groundwater---are hotspots of biogeochemical activity within small streams and large rivers alike. These areas have high storage of organic matter, potentially strong redox gradients and slower transport of water all of which can facilitate biogeochemical reactions [@Zarnetske:2011kd]. If flow of water is high into hyporheic zones and biogeochemical processing is fast, then these areas may be sites of much of the nutrient processing in streams and rivers. Large gravel-bedded, alluvial rivers can have extensive hyporheic zones with high exchange of water [@stanford1993ecosystem]. These regions have been canonical examples of places to study hyporheic flow in the context of viewing rivers as a large corridor [@hauer2016gravel]. Yet we do not know the degree to which the hyporheic zones in these rivers contribute to overall riverine N transformation.

Denitrification is a notoriously difficult flux to estimate [@groffman2006methods]. Chamber estimates are difficult to scale, tracer studies that work well at stream reach scales are not easily duplicated in fast flowing groundwater. In addition, many methods for denitrification work best when rates are high due to high concentrations of the electron acceptor, NO${_3}^-$. In the hyporheic floodplain of our study site, Nyack Floodplain aquifer at Middle Fork Flathead River, NO${_3}^-$ concentrations are low (1-17 $\mu$mol L$^{-1}$), thus we might expect low denitrification fluxes. Thus a method that both scales easily and is sensitive to low fluxes is needed to estimate denitrification at Nyack.

We combined estimate of oversaturation of N$_2$ gas [@gardner2016balancing, @popp2020new] with theory based on respiration [@Madinger_2019] to estimate scaled fluxes of denitrification. Denitrification is simply bacterial respiration of NO$_3^{-}$. Free energy from NO$_3^{-}$ is only slightly less than that gained from reducing O$_2$ during respiration. Madinger and Hall (2019) found that N$_2$ production covaried with O$_2$ depletion in chambers showing that denitrification and aerobic respiration occurred simultaneously. This pattern is common at ecosystem level [@Mulholland:2008cj]. We reasoned that in oxic groundwater, rates of nitrate respiration would covary with oxygen respiration because both processes occur simultaneously, provided that that conditions remain oxic. Thus if we know that ratio of nitrate respiration (as its product N$_2$ concentration) to O$_2$ respiration (as O$_2$ concentration) we can estimate the flux provided that we know the aquifer-wide flux of aerobic respiration, i.e. O$_2$ consumption. We can measure the ratio of dissolved N$_2$ to O$_2$ precisely using a membrane inlet mass spectrometer and normalizing both gases to an inert gas, argon. To estimate a denitrification rate based on N$_2$ requires knowing the flux of N$_2$ production. This flux is easily measured in a closed container such as a bottle [@Madinger_2019] and it is possible to measure in an open ecosystem where gas exchange with the atmosphere is known [@Reisinger:2016kq]. In the case of the floodplain aquifer gas exchange is unknown, despite strong evidence of O$_2$ exchange with the atmosphere [@Parker_nyack] However, if we know the ratio of N$_2$ produced to O$_2$ consumed, and we know the flux of O$_2$ consumed, i.e., the respiration rate in the aquifer, we can solve for the rate of NO$_3$ respiration to N$_2$ gas [@Madinger_2019].

This project asked: What are the rates of hyporheic denitrification in an alluvial aquifer with low ambient concentrations of electron acceptors (NO$_3$) and electron donors (dissolved organic carbon (DOC))? To address this question required developing new methods. The first was in-situ isotope pairing methods along a particular flowpath. This method was not sensitive enough to estimate dentrification. Thus we used whole floodplain surveys of excess N$_2$ gas, the end product of denitrification. We answered this question via 3 sub objectives: 1. We estimated the degree to which N$_2$:Ar, the end product of denitrification (normalized to inert Ar concentrations) covaried with O$_2$:Ar in 16 groundwater wells in 8 sampling events throughout a year. We developed multilevel statistical models accounting for sample variation, temporal variation in one well, and spatial variation among wells. 2. We scaled the resulting ratio of N$_2$:Ar to O$_2$:Ar to mean denitrification flux using previously estimated long term rates of O$_2$:Ar decline from [@Helton:2012],. 3. We compared this denitrification flux to that measured in multiple similar studies at river reach scales based on the LINX2 study [@Mulholland:2008cj].

# Study Site

The Nyack Floodplain of the Middle Fork Flathead River is a 10-km river segment in northwest Montana with a snowmelt dominated hydrograph. Base flow on the site is 15 m$^3$ s$^{-1}$, mean annual discharge is 80 m$^3$ s$^{-1}$, and mean annual peak discharge is 480 m$^3$ s$^{-1}$ [@Poole:2006iv]. As channel water traverses the floodplain, 30% of base flow is lost to the alluvial aquifer. The infiltrating water flows downstream through the aquifer, re-emerging in the main channel and lateral spring channels. The alluvial aquifer discharges back to the floodplain surface before the river flows into a bedrock-confined canyon at the north end of the floodplain. The anabranched channel pattern, extensive alluvial aquifer, and unregulated hydrograph provides a useful natural laboratory for studying the hydrology and biogeochemistry of expansive, coarse-grained alluvial aquifers. This site also has extensive history of hyporheic research. In particular there is both past and current data collection on hyporheic flow in the alluvial aquifer [@Poole:2006iv], combined with biogeochemical transformations [@Helton:2012], yet there has been little work on N transformations at this site. Nitrate concentrations are low and variable throughout the aquifer, averaging 90 $\mu$g NO$_3^-$-N L$^{-1}$, with high variability; the coefficient of variation is 210% showing high potential for biogeochemical control on this variation NO$_3^-$ concentrations. The site is instrumented with more than 50 sampling wells that span the floodplain laterally and longitudinally (@fig-map).

![Map of Nyack floodplain study site. White dots indicate wells sampled for this study. River flows south to north.](/Users/bob.hall/Dropbox/Hyporheic_N_project/denit/report/Nyack_Wells.jpg){#fig-map}

# Methods

## In situ isotope pairing

One way to estimate rates of denitrification is by measuring the rate at which isotopically labeled nitrate ($^{15}$NO$_3$) transforms to the end product ($^{15}$N$_2$). This method works well in streams [@Mulholland:2008cj] and as a tracer addition and is the cornerstone of the well known isotope pairing method [@nielsen1992denitrification]. A key distinction in the use of ($^{15}$NO$_3$) is whether one uses it as a tracer, in that the amount of ($^{15}$NO$_3$) added does not appreciably increase the concentration of the NO$_3$ pool, or isotope pairing where one swamps the NO$_3$ with labeled $^{15}$NO$_3$. We tried both of these methods, but focus only on the pairing method here.

We used in-situ additions of tracer, which we felt would provide more accurate estimates of denitrification rates that removing a sediment sample. In situ techniques can work in non flowing groundwater using push-pull methods [@aoki2017push], but in flowing groundwater, such as Nyack, required wells that spanned a flowpath. We tested for flowpaths by injecting salt in $>15$ recently pumped and cleaned wells at Nyack and then attempting to recover the tracer in nearby wells (3-15 m away). Following an extensive search, we found a pair of wells at ''Movie Road'' where we could follow a salt slug with a 2-h travel time and record its breakthrough curve in a well 5 m away. We attempted a tracer addition,where we added only 20% of $^{15}$N tracer relative to the ambient NO$_3^{-}$ pool. We could detect no labeled tracer thus we reasoned that we should use istope pairing methods where we would add enough labelled NO$_3^{-}$ such that most N$_2$ produce is $^{30}$N$_2$.

For each of 3 injection experiments we poured a known amount of salt and Na$^{15}$NO$_3^{-}$ tracer in to an injection well and then chased it with 5 L of water to move the tracer from the well to the adjacent groundwater. We collected samples through time to quantify the solute breakthrough curve. We estimated salt concentration via measuring specific electrical conductivity ($\mu$S cm$^{-1}$). We collected water samples for dissolved gas analysis bu pumping water with a Watson-Marlow peristaltic pump into 12 mL Exetainer vials, and overflowing at least three times. We injected 0.1 mL 50% w/v ZnCl$_2$ as a preservative and immediately capped the vial without entraining any air bubbles.

## Measuring dissolved gases

We measured dissolved gases using membrane-inlet mass spectrometry (MIMS). Gases diffuse through a membrane and enter a Pfeiffer quadrupole mass spectrometer where we scan for masses on common and rare gases. We used a Bay Instruments MIMS, which calibrates gas concentrations based on stirred, air-saturated water held at constant temperatures in a water bath set at temperatures just above and below the temperature of the water samples for any particular analysis. The MIMS operates by pumping water at about 3 mL/min from sample (or standard) through stainless stel tubing in the cold water bath. This tube enters and evacuated chamber with a short section of semipermeable silicone that acts as an inlet. We ran a set of the 2 standards for each 5-10 samples. We collected current data fron a user defined range during eqach pumped sample following a short (1 min) equilibration time.

For samples where N$_2$ gas was the target analyte, gases flowed through a quartz tube filled with shaved copper and heated to 600 $^\circ$C set between the inlet and the mass spec. The copper reduced oxygen species (O$_2$, NO) which have the potential to interfere with N$_2$ and especially $^{30}$N$_2$. Indeed, even with the copper column in place the ambient current ratio at $m/z$ 30:28 was $\sim 1.8 \times 10^{-4}$, higher than the predicted ratio of $0.003678^2 = 1.35 \times 10^{-5}$ showing that some compounds (e.g., NO) with $m/z$ 30 were pasing through the reduction column and entering the mass spec. However, a $m/z$ 30:28 that is  $2 \times 10^{-4}$ is within spec for these instruments (Todd Kana, pers. comm.)

## N$_2$ gas oversaturation survey

We assessed denitrification rates by using another method that measures oversaturation of N$_2$ gas relative to argon (Ar) an unreactive gas. Denitrification will produce excess N$_2$ gas, and the degree of excess is a function of the denitrification rate. We then related this oversaturation to the degree of undersaturation of O$_2$. We hypothesized that respiration of NO$_3$ should relate with respiration of O$_2$, albeit at lower rates, and indeed both within river chamber addition and across rivers, nitrate respiration scales with oxygen respiration [@Madinger_2019], thus we attempted this method here. We collected an extensive data set of samples from 16 wells in the floodplain (Fig. @fig-map) across 8 dates throughout the year. We collected water samples for dissolved gases as the above tracer experiments. We analyzed 6 replicate vials on separate runs of the MIMS without a furnace (for dissolved O$_2$) and with the O$_2$ trapping furnace (for dissolved N$_2$) in case of possible interference of O$_2$ on N$_2$ measures [@Eyre_2002]. At each date we also collected waster sample for dissolved organic carbon (DOC) and NO$_3^-$

Given the N$_2$:Ar in any sample we needed to estimate the anomaly, which is the measured ratio relative to the ratio in the absence of biological activity, i.e., saturation concentrations. Temperature is a primary control on N$_2$: Ar, and typically one simply uses the temperature at sampling to compute \[N$_2$:Ar\]$_{sat}$ using standard equations [@hamme2004solubility]. But in groundwater, the exchange of gas with the atmosphere my be slow enough that it occurred well before the sampling date when the aquifer was at a different temperature. We estimated this equilibration temperature based on the absolute concentration of Ar in samples. We simply inversely solved the solubility equation to estimate Ar from temperature. Because the algebra is difficult to solve for temperature, we used function nlm() in R to solve for the saturation temperature given [Ar]. We then estimated the \[N$_2$:Ar\] anomaly as $\Delta [\text{N}_2:\text{Ar}]= [\text{N}_2:\text{Ar}] - [\text{N}_2:\text{Ar}]_{sat}$.

To estimate a denitrification rate based on N$_2$ requires knowing the flux of N$_2$ production. This flux is easily measured in a closed system such as a bottle [@Madinger_2019] and it is possible to measure in an open system where gas exchange with the atmosphere is known [@Reisinger:2016kq]. In the case of the floodplain aquifer, gas exchange is unknown, despite strong evidence of O$_2$ exchange with the atmosphere [@Parker_nyack]. However, if we know the ratio of N$_2$ produced to O$_2$ consumed, and we know the flux of O$_2$ consumed, i.e., the respiration rate in the aquifer, we can solve for the rate of NO$_3$ respiration to N$_2$ gas [@Madinger_2019].

To estimate the the ratio of N$_2$ produced to O$_2$ consumed, we used multilevel regression models where we regressed N$_2$ anomaly vs O$_2$ anomaly, using sampling dates and individual wells as grouping variables. This model had 3 levels. First was a measurement model, a within well model, and an among well model.

Because we collected 6 samples for both \[N$_2$:Ar\] and \[O$_2$:Ar\] we can calculate and account for measurement error in the analyses. This model is \begin{equation}
N_{s,d,w} = N_{d,w} + \varepsilon_{s,N}
\end{equation}

where $N$ is $\Delta [\mathrm{N}_2:\mathrm{Ar}]$ for sample, $s$ during date $d$ in well $w$. $N_{d,w}$ is the mean of the 6 samples for any date and well. $\varepsilon_{s,N}$ is random normally distributed variation with mean of 0 and standard deviation $\sigma_{s,N}$. We made the same measurement model for $\Delta [\mathrm{O}_2:\mathrm{Ar}]$,

```{=tex}
\begin{equation}
O_{s,d,w} = O_{d,w} + \varepsilon_{s,O}
\end{equation}
```
The next level was a within-well temporal model. \begin{equation}
N_{d,w}= N_{w} + \varepsilon_{d,N}
\end{equation} and \begin{equation}
O_{d,w}= O_{w} + \varepsilon_{d,O}
\end{equation}

Contrary to our hypotheses, there was no strong relationship between $\Delta [\text{O}_2:\text{Ar}]$ and $\Delta [\text{N}_2:\text{Ar}]$ within any one well, hence the model simply was the mean value for each across all dates.

The third level was regression of $$
N_w = a + b + \varepsilon_w
$$ {#eq-thirdlevel} where $a$ is the intercept and $b$ is the slope. $\varepsilon_w$ was the residual variation and was randomly distributed normal variation with mean = 0 and standard deviation $\sigma_w$. We are most interested in the value of $b$ as it represent the ratio of moles N produced for each mole of O$_2$ consumed.

We fit these models using a Bayesian approach and used the program Stan to simulate the posterior distributions using Hamiltonian Monte Carlo algorithm. Priors for variance parameters were truncated normal distributions $\sigma_{d,O}\sim|normal(0,5)|$, all of the others were $\sim |normal(0,1)|$. $\sigma_{d,O}$ had higher prior expectations for variation because $\Delta [\text{O}_2:\text{Ar}]$ varies strongly with time in any one well. Prior on intercept $a$ was centered on zero based on the expectation that no respiration of O$_2$ would lead to no NO$_3^{-}$ respiration also, thus $a\sim normal(0,1)$, where the standard deviation of this distribution reflected the small amount of total variation one might see in $\Delta [\text{N}_2:\text{Ar}]$. The slope, $b$ had a weakly informative prior expectation based on findings from Madinger and Hall. At a concentration of NO$_3^{-}$ of 2 $\mu$mol L$^{-1}$ we would expect a ratio centered at 0.008. Given that the Nyack environmental conditions differ greatly from other sites in the summary figure in Madinger and Hall, we gave this slope a wider estimate or variation (0.05) to reflect lack of knowledge, thus the prior for $b$ was $b\sim(normal(0.008,0.05))$.

We scaled this ratio of NO$_3$ respiration : aerobic respiration (slope, $b$) to denitrification based on modeled oxygen loss. @Helton:2012 estimated O$_2$ concentrations as a function of water residence time at Nyack, the slopes of these relationship thus represent a rough estimate of aerobic respiration. They fit Michaelis-Menten models to O$_2$ versus water residence time for 6 different dates. We estimated respiration as a function of oxygen concentration and bootstrapped parameter estimates for these 6 Michalis-Menten fits. We generated 1000 boostrapped estimates of respiration by randomly sampling a pair of $k_s$ and $R_{max}$ from the 6 respiration estimates in Helton and etimating respiration $R$ as $$R_{boot} = \frac{O_{boot}\times R_{max}}{k_s+O_{boot}}$$ where R is a vector of 1000 respiration estimates, $O_{boot}$ is a vector of of 1000 bootstrapped estimates of the mean dissolved O$_2$ concentrations from the 16 wells. $R_{max}$ is the maximal respiration rate and $k_s$ is the half-saturation constant for any of the 6 pairs of estimates from [@Helton:2012].

Given an estimate of hyporheic respiration we can estimate the denitrification flux ($D$, mmolN$_2$ m$^{-3}$ d$^{-1}$) as simply \begin{equation}
D = R_{boot}b
\end{equation}

where $b$ is 1000 samples from the probability distribution of $b$. We converted this flux into a rate (units, d$^{-1}$) as $K_{D} = D / N$, where $N$ was the bootstrapped mean \[NO$_3^{-}$\] from the 16 wells.

# Results

## In-situ isotope pairing

Breakthrough curves showed that we could successfully recover tracer salt in the measurement well (@fig-salt) during an addition in August 2019. Five m down the flowpath, specific conductivity peaked about 120 min following the salt and isotope injection. Given the 188 mg $^{15}$N-NO$_3^{-}$ added to the well and the amount of salt (50 g), $^{15}$NO$_3$ concentration would have peaked at 0.39 mg N/L, considerably higher than ambient concentration of 0.03 mg N/L.

We detected no $^{15}$N tracer in the $^{29}$N$_2$ or $^{30}$N$_2$ pools (Fig. (@fig-tracer). It is possible that denitrification rates were too low to assess any labeled N$_2$, thus we estimated what the label would have been if 1% or 0.1% of NO$_3$ pool were converted to N$_2$ during the 2 h travel time. We made no transport model, but rather assumed that denitrification would instantly convert $^{15}$NO$_3$ to $^{30}$N$_2$. Because most of the nitrate was $^{15}$NO$_3$, most N$_2$ formed during the experiment would be $^{30}$N$_2$. If 1% of the tracer were denitrified, we would have observed a clear signal in the $m/z$ 30:28 during the breakthrough curve. 0.1% appears to be the detection limit for this method, for if that amount were denitrified, we would have only seen a small increase. We conducted three tracer additions at this well and present the one with the most $^{15}$N added here. The other two had identical results of no tracer detected. Based on these findings we reasoned that it was impractical to continue this method. In addition, this pair of wells was by far the best of the nearly 20 well pairs that we tried in terms of following a flowpath, thus we did not pursue attempting this method in other parts of the floodplain.

```{r, echo=F, message=FALSE, warning=FALSE}

iso_aug<-read_csv("/Users/bob.hall/Dropbox/Hyporheic_N_project/denit/Well_Aug26_2019_Final.csv")
iso_aug<- iso_aug %>% filter (!grepl("Std", Location)) #lose the standards


iso_aug$add_Time <- as.numeric( (hms(iso_aug$Collection_Time) - hms("10:55:00")) ) /60


#some math
salt_add<- 50 *2100  # 50 g salt, 2100 uS per gram
bkg_salt<- mean(iso_aug$InWellConductivity_uS_cm[1:5])
n15_add <- (54*20) / (86/15)  # mg 15N

iso_aug$n15_conc <- (n15_add / salt_add) * (iso_aug$InWellConductivity_uS_cm - bkg_salt)

n30_bkg_ratio <- 0.003678^2
mims30_bkg_ratio <- mean( iso_aug$X30.28[1:5])

f01<- 0.01
N_30_conc_01 <- 0.5*f01* iso_aug$n15_conc
N_30_ratio_01 <- N_30_conc_01 / iso_aug$X28.Conc

f001<- 0.001
N_30_conc_001 <- 0.5*f001* iso_aug$n15_conc
N_30_ratio_001 <- N_30_conc_001 / iso_aug$X28.Conc
```

```{r}
#| echo: FALSE
#| label: fig-salt
#| fig-cap: Specific conductivity increased in the measurement well and peaked about 2 h following injection into a well 5 m up the flowpath. 
#| 
plot( iso_aug$add_Time, iso_aug$InWellConductivity_uS_cm, pch=16, xlab="Time from addition start (min)", ylab= "Specific conductivty, µS/cm")


```

```{r}
#| echo: FALSE
#| label: fig-tracer
#| fig-cap: $^{30}$N$_2$ data (black points, reported as the ratio of mass 30 / mass 28) did not increase during the addition. Red and blue lines indicate what the magnitude of the signal would have been if 1% or 0.1% of the tracer were denitrified, 0.1% appears to be the detection limit.

plot( iso_aug$add_Time, N_30_ratio_01 + mims30_bkg_ratio, type="l", ylim=c(0.00016,0.00032), 
      ylab="(m/z 30) / (m/z 28)", xlab = "Time from addition start (min)", col="red", lwd=1.5  )
lines(iso_aug$add_Time, N_30_ratio_001 + mims30_bkg_ratio, col="blue", lwd=1.5)
points (iso_aug$add_Time, iso_aug$X30.28, pch= 16,col="black")
legend(200, 0.00030, legend=c("1% denitrified", "0.1% denitrified"),
       col=c("red", "blue"), lty=1, cex=0.8)

```

## [N$_2$:Ar] survey

```{r}
#| echo: FALSE
#| message: FALSE
#| warning: FALSE

source("/Users/bob.hall/Dropbox/Hyporheic_N_project/denit/mims_gas_functions.R")

well_data<- read_csv("/Users/bob.hall/Dropbox/Hyporheic_N_project/denit/Full_Dataset.csv")


chem_data<- read_csv("/Users/bob.hall/Dropbox/Hyporheic_N_project/denit/Nitrate_and_DOC.csv")
chem_data<- chem_data %>% select(Location, Date, Analyte, ReportedResult)
chem_data <- pivot_wider(chem_data, names_from=Analyte, values_from = ReportedResult)
chem_data$DOC <- as.numeric (chem_data$DOC )
chem_data$NO3<- as.numeric (chem_data$NO3 )


#get rid of standards

well_data<- well_data %>% filter (!grepl("Std", Location))

#calculate the previous temperature
temp_ar<-function(ar, bp){
  
  minar<-function(P, ar, bp ) {
    
    ts<-log((298.15-P) / (273.15 + P))
    a0<-2.79150
    a1<-3.17609
    a2<-4.13116
    a3<-4.90379
    
    u<-10^(8.10765-(1750.286/(235+P)))
    satar<-(exp(a0 + a1*ts + a2*ts^2 + a3*ts^3))*((bp-u)/(760-u))
    arcalc<-watdens(P)*satar*(39.948/1000)##converts umol/kg to mg/L
    (ar-arcalc)^2
  }
  
  out<-nlm(minar, p=10, ar, bp)
  out$estimate
  
}
well_data$otemp<- NA

for (i in 1:length(well_data$X40.Conc)){
  well_data$otemp[i] <- temp_ar(well_data$X40.Conc[i], well_data$Pressure[i] )
} 

##calc previous N2:Ar sat and molar anomaly for both N2 and O2
well_data$N.Ar_prevsat<- nsat( well_data$otemp,well_data$Pressure)/arsat( well_data$otemp,well_data$Pressure)
well_data$Nar_anomaly <- (40/28)*(well_data$N2.Ar.Conc - well_data$N.Ar_prevsat)

well_data$O2.Ar_prevsat <-  osat1( well_data$otemp,well_data$Pressure)/arsat( well_data$otemp,well_data$Pressure)
well_data$Oar_anomaly <- (40/32)*(well_data$O2.Ar.Conc - well_data$O2.Ar_prevsat)

well_furnace<- well_data[well_data$Furnace==1 & well_data$Leak==0,]
well_nofurnace<- well_data[well_data$Furnace==0 & well_data$Leak==0,]


##calculate means for report

well_furnace_mean <- well_furnace %>% group_by(Location,Date) %>% 
  summarize(f_OAr=mean(O2.Ar.Conc), f_NAr_anomaly=mean(Nar_anomaly), f_NAr=mean(N2.Ar.Conc), Temp = mean(Temp),
            f_otemp=mean(otemp))

                                                                                     

well_nofurnace_mean <- well_nofurnace %>% group_by(Location,Date) %>% 
  summarize(nf_OAr=mean(O2.Ar.Conc), nf_OAr_anomaly=mean(Oar_anomaly),  nf_NAr=mean(N2.Ar.Conc), nf_otemp=mean(otemp), nf_NAr_anomaly=mean(Nar_anomaly), oconc=X32.Conc  )


well_mean<- left_join ( well_furnace_mean, well_nofurnace_mean, by=c("Location", "Date"))

well_mean<- left_join (well_mean, chem_data, by=c("Location", "Date") )


##compare sample vs collection temps
#ggplot(well_mean, aes(x = Temp, y =f_otemp)) + geom_point() +facet_wrap(~Location)

#ggplot(well_mean, aes(x = nf_otemp, y =f_otemp)) + geom_point() +facet_wrap(~Location)

well_mean_mean <- well_mean %>% group_by(Location) %>% summarize(nf_OAr_anomaly=mean(nf_OAr_anomaly),
     f_NAr_anomaly=mean(f_NAr_anomaly) , NO3 = mean (NO3, na.rm=T), DOC = mean (DOC, na.rm=T), oconc = mean (oconc, na.rm=T) )       

```

Within wells, the [N$_2$:Ar] anomaly did not covary with [O$_2$:Ar]. A variable slope, variable intercept model did not have higher support as an intercept model alone (based on leave-one-out cross validation). Hence we refit an intercept only model with a hierarchical prior of mean[N$_2$:Ar] as a linear mean [O$_2$:Ar].

```{r}
#| echo: FALSE
#| message: FALSE
#| warning: FALSE

well_furnace_sel<-well_furnace %>% select(Location = Location, Date = StartDate, f_OAr=O2.Ar.Conc,f_NAr_anomaly=Nar_anomaly,
                                          f_NAr=N2.Ar.Conc,  f_otemp=otemp, Temp=Temp)

well_nofurnace_sel <- well_nofurnace %>% select(Location = Location, Date = StartDate, nf_OAr=O2.Ar.Conc,nf_NAr_anomaly=Nar_anomaly,
                                                nf_NAr=N2.Ar.Conc, nf_OAr_anomaly=Oar_anomaly,  nf_otemp=otemp)


well_sel <- left_join(well_furnace_sel %>% group_by(Location, Date) %>% mutate(id = row_number()),
          well_nofurnace_sel %>% group_by(Location, Date) %>% mutate(id = row_number()), 
          by = c("Location", "Date", "id"))


well_sel$well_id <- well_sel%>% group_by(Location) %>%
  group_indices() 

well_sel$well_date_id <- well_sel%>% group_by(well_id, Date) %>%
  group_indices() 


well_sel_mean<- well_sel%>% group_by(Location, Date) %>% summarise() 
well_sel_mean$well_id <- well_sel_mean%>% group_by(Location) %>%
  group_indices() 

####list for stan

##need 2 data sets, ine for N and one for O because of NA due to 5 and not 6 samples collected
well_sel_N<-well_sel[!is.na(well_sel$f_NAr_anomaly),  ]
well_sel_O<-well_sel[!is.na(well_sel$nf_OAr_anomaly),  ]



well_sel_data <- list(
  NobsN = length(well_sel_N$f_NAr_anomaly),
  NobsO = length(well_sel_O$f_NAr_anomaly),
  Nwell_date= max(well_sel$well_date_id), 
  Nwell = max(well_sel$well_id),
  well_date_id_N = well_sel_N$well_date_id,
  well_date_id_O = well_sel_O$well_date_id,
  well_id = well_sel_mean$well_id , 
  n2anomaly = well_sel_N$f_NAr_anomaly, 
  o2anomaly = well_sel_O$nf_OAr_anomaly  )

##run stan
#wellfit <- stan("n2_int_o2_meas.stan", data = well_sel_data ,  iter = 2000, chains = 4)



load(file="/Users/bob.hall/Dropbox/Hyporheic_N_project/denit/wellfit.R")
wellmean_summary <- summary(wellfit, pars = c("wellmean","O2mean"), probs = c(0.5))$summary
n_values <- wellmean_summary[1:16,4]
o_values <- wellmean_summary[17:32,4]

wellmean_slope <- summary(wellfit, pars = c("b"), probs = c(0.05,0.5, 0.95))$summary

bsteps<- rstan::extract(wellfit, pars = "b")
asteps<- rstan::extract(wellfit, pars = "a")



```

```{r}
#| echo: FALSE
#| label: fig-withinwell
#| fig-cap: Within wells there  was no apparent relationship between $\Delta [\text{N}_2:\text{Ar}]$ and $\Delta [\text{O}_2:\text{Ar}]$. Panels represent indivual wells ampled 8 times.  Points are the mean of 6 analytiocal replicates.
#| message: FALSE
#| warning: FALSE

##plot for report
well_mean_plot<-ggplot(well_mean, aes(x = nf_OAr_anomaly, y =f_NAr_anomaly)) + geom_point() +facet_wrap(~Location)+
xlab(expression( paste(Delta, " (O"[2],":Ar)" ))) + ylab(expression( paste(Delta, " (N"[2],":Ar)" ))) +
  theme_bw()

ggsave(filename="well_mean_plot.pdf",
       plot = well_mean_plot,
       device = pdf,
       width = 6,
       height = 6,
       units = "in")


```

```{r}
#| echo: FALSE
#| label: fig-amongwell
#| fig-cap: Mean dinitrogen concentration declined with oxygen across all wells.  Y axis is $\Delta [\mathrm{N}_2:\mathrm{Ar}]$ and X axis is $\Delta [\mathrm{O}_2:\mathrm{Ar}]$ Line is best fit from model in equation 1.  Light blue lines represent 100 samples from the joint posterior distribution of the intercept and slope.


pdf(file="N_O_plot.pdf", height = 2.5, width=3)
par(mai=c(0.7,0.7,0.1,0.1), mgp=c(2,1,0))
plot(n_values ~ o_values, xlab=expression( paste(Delta, " (O"[2],":Ar)" )),
     ylab=expression( paste(Delta, " (N"[2],":Ar)" )), pch=16, col="blue" , xlim=c(-16,0)   )
for(i in 1:1000){
  lines(o_values, asteps$a[i] + bsteps$b[i]*as.numeric(o_values), col = alpha("lightblue", 0.1) )
}
points(n_values ~ o_values, pch=16)
lines(o_values, median(asteps$a) + median(bsteps$b)*as.numeric(o_values))

dev.off

```

Among wells, [N$_2$:Ar] anomaly (mol:mol) strongly negatively covaried with [O$_2$:Ar] @fig-amongwell. The slope of this relationship was `r wellmean_slope[5]` with a 90% credible interval of `r wellmean_slope[4]`, `r wellmean_slope[6]`. This slope implies that for each mol of O$_2$ consumed by aerobic respiration, denitrifying bacteria produced 0.07 mol N$_2$.

```{r echo=F, results='hide'}

##Helton 2012 data
#r<-c(0.16,0.1,0.07,0.08,0.12,0.18)/32
umax<-c(0.32,0.14,0.23,0.19,0.16,0.37)/32
ks<- c(4.28,4.31,4.53,4.34,4.35,5.08)/32
mm_mat<- cbind(ks,umax)

o_conc<-numeric(1000) ##convert to mols here
for (i in 1:1000) {o_conc[i] <- mean(sample(well_mean_mean$oconc/32,16,replace=T)) }

resp<-numeric(1000)
for (i in 1:1000) {
  mm<- numeric(8)
    for (j in 1:8)  { 
      row<- sample(nrow(mm_mat), 1, replace=T)
      mm[j]<- o_conc[i]*mm_mat[row,2]/(mm_mat[row,1]+o_conc[i])
    }
  resp[i] <- mean(mm)
}



d<-bsteps$b[1:1000]

d_flux<- resp*d  # the big scale.  Units mol m-3 d-1
#hist (d_flux)

n<-numeric(1000) #(n is nitrate N mg/L )
for (i in 1:1000) {n[i] <- mean(sample(well_mean_mean$NO3,16,replace=T)) }
mean(n/14)

k<-d_flux*2 / (n/14)
#hist(k)

k_quantile<- quantile(k, c(0.05,0.5,0.95))
d_flux_quantile <- quantile(-d_flux, c(0.05,0.5,0.95))

d_flux_quantile*1000 #mmol m-3 d-1


z<- 5  #m to bottom of wells
por<- 0.3  #porosity 
d_flux_quantile*1000*z*por #mmol m-2 d-1  The 0.3 is the water fraction
d_flux_quantile*1000*z*por*14 #mg m-2 d-1
d_flux_quantile*1000*z*por*14/24 #mg m-2 h-1


d_flux_quantile*1000*z*por*365 #mmol m-2 y-1
d_flux_quantile*1000*z*por*365*14/1000 #g m-2 y-1
d_flux_quantile*1000*z*por*365*14*10000/(1000*1000) # kg ha-1 y-1


lowk<- quantile(-k,0.05)
midk<- quantile(-k,0.5)
highk<- quantile(-k,0.95)

k_hour<- -k/24

kdf<- as.data.frame(k)

##how much NO3 flows in mff in a day
Q<-1000/35.2
Q*86400*4/1000 #mol/d

#Nyack area
na<- 2*10*1e6 #m2
d_flux_quantile*1000*por*z *na *0.001 # mol N floodplain each day
```

## Scaling [\Delta N$_2$:Ar] with [\Delta O$_2$:Ar] to estimate denitrification

Scaling of slope $b$ with estimated rates of O$_2$ consumption derived from [@Helton:2012] gave a denitrification flux of `r d_flux_quantile[2]*2*1000` mmol N m$^{-3}$ d$^{-1}$ with a credible interval of `r d_flux_quantile[1]*2*1000` , `r d_flux_quantile[3]*2*1000`. This flux provides a turnover rate for dissolved NO$_3$, $K_d$ of `r k_quantile[2]` with credible interval of [`r k_quantile[1]` , `r k_quantile[3]`].

When considered as a turnover rate, denitrification was on the low end of that measured in the LINX2 experiments, in the bottom 30% of rates. Mean rate was near 0.1/day meaning that on average denitrification reduced 10% of NO$_3$ each day in the Nyack aquifer.

```{r}
#| echo: FALSE
#| label: fig-linxcompare
#| fig-cap: Denitrification measured as a rate of NO$_3$ uptake (1/d) in the Nyack aquifer (red density) was at the lowest region of 49 whole-stream estimates in the LINX2 study (Mulholland et al. 2008) (blue histogram).
#| warning: false
#| message: false

linxK<- read.csv("/Users/bob.hall/Dropbox/Hyporheic_N_project/denit/linxK.csv")


##Plot linxK
linx_plot<-ggplot(linxK, aes(K*24 )) +              
  geom_histogram(bins = 20, colour="black", fill="lightblue")  +
  scale_x_log10( limits=c(0.01,101)) + 
  #geom_vline(aes(xintercept=0.002),
  #                           color="blue", linetype="solid", size=1) +
  #geom_vline(aes(xintercept=lowk),
  #           color="green", linetype="dashed", size=1)+
  #geom_vline(aes(xintercept=midk),
  #           color="blue", linetype="solid", size=1)+
  #geom_vline(aes(xintercept=highk),
   #          color="green", linetype="dashed", size=1)+
  labs(x="Denitrification rate (1/d) ", y = "Count", "Legend") +
  theme_classic()+
  theme(text=element_text(size=15),  plot.margin = unit(c(1, 1, 1, 1), "cm"  ) )+
  geom_density(data=kdf, aes(x=-k, y=0.003*..count..), alpha=0.3,colour="black", fill="red")+
  annotate("text", x = 10, y = 4, label = "LINX2", col="lightblue", size =8)+
    annotate("text", x = 0.02, y = 4, label = "Nyack", col="red", size =8, alpha=0.4)

linx_plot

ggsave(filename="linx_plot.pdf",
       plot = linx_plot,
       device = pdf,
       width = 6,
       height = 5,
       units = "in")


```

# Discussion

Denitrification fluxes were low in the Nyack floodplain aquifer. The isotope pairing approach failed to detect any labeled tracer and showed that at a maximum, denitrification specific rates were $<0.001/$h, or 0.024/d. This rate was lower than the posterior distribution for rates measured using N$_2$:Ar (@fig-linxcompare), showing the difficulty of finding any labeled tracer in the 2h travel time between the injection well and the sampling well. The lack of tracer does agree well with the \[N$_2$:Ar\] survey showing that in fact that denitrification fluxes were quite low.

The \[N$_2$:Ar\] survey provided a quantitative estimate of dentrification fluxes and rates. But the relationship between \[O$_2$:Ar\] and N$_2$ did not go as we had predicted. We expected for the large amount of sample, temporal and spatial variability and is why we we sampled 16 wells 8 times with 6 samples each. But we expected that \[N$_2$:Ar\] would decline with \[O$_2$:Ar\] both within and among wells, yet this relationship only existed among wells. Reasons for this finding are unknown. We might expect that that spatial differences in NO$_3^{-}$ and DOC drive variation in $\Delta [\text{N}_2:\text{Ar}]$, but there was no clear statistical association between these variables. Despite high variation in relative ranges in DOC (range 0.35-0.75 mgC/L) or NO$_3^{-}$ (range 0.02-0.25 mgN/L), these represent low absolute variation and may not be large enough to drive variation in $\Delta [\text{N}_2:\text{Ar}]$.

One difficulty of estimating denitrification in groundwater using ambient N$_2$ concentrations is the effect of excess air. Excess air is a phenomenon whereby bubbles of air under hydrostatic pressure get squeezed into water, thus the resulting ratios of gas resemble atmospheric ratios instead of ratios set by Henry's Law [@Aeschbach_1999]. Excess air will increase [N$_2$:Ar] thus making it look like denitrification [@popp2020new]. We have two lines of evidence to suggest that excess air is a small problem. One is that we measured $^{84}$Kr and its ratio with Ar in water resembled those of predicted by Henry's law with no apparent enrichment (data not shown). The other, and stronger, argument is that we do not evalaute the absolute magnitude of $\Delta [\text{N}_2:\text{Ar}]$ but rather the relative change in that magnitude as a function of $\Delta [\text{O}_2:\text{Ar}]$. Even if $\Delta [\text{N}_2:\text{Ar}]$ did reflect some unknown amount of excess air, we find it highly unlikely that this enrichment would positively covary with depleted oxygen due to respiration.

A slope estimate of -0.07 between $\Delta [\text{N}_2:\text{Ar}]$ and $\Delta [\text{O}_2:\text{Ar}]$, i.e., $b$ means that for every mole of O$_2$ consumed, 0.07 mole of N$_2$ were produced, presumabaly via reduction of 0.14 moles of NO$_3^{-}$. We scaled this ratio using estimates for O$_2$ decline at Nyack from Helton et al. (2012). Our scaling captured the uncertainty in both $b$ via its marginal probability distribution and in O$_2$ consumption, based on spatial variability reported in Helton et al. (2012). But we assume that actual uncertainty is much higher due to processes not captured in our simple models. We have no way of quantifying this uncertainty. The value of $b= 0.07$ was higher than we expected based on the summary in Madinger and Hall (2019), where mean values of $v$ from their work and LINX2 suggest that $b \sim 1$% given the mean NO$_3^{-}$ of 6 $\mu$mol/L. The higher value of $b$ meaured here suggest that a higher fraction of total respiration in the Nyack aquifer is derived for denitrification. We have no easy explanation for this observation.

Denitrification fluxes were very low, 0.3 mmol N m$^{-3}$ d$^{-1}$ (CI, 0.07-0.5). If we assume depth of the alluvial aquifer is 5 m (which is the depth of the wells) and porosity of the sediment is 0.3, then area-specific flux is 0.45 mmol N m$^{-2}$ d$^{-1}$. When scaled this way, denitrification fluxes were similar to those measured in the LINX2 experiment, probably because the aquifer is at least 5 m deep.

Denitrification rates (expressed at per day) in Nyack were $\sim$ 0.1 d$^{-1}$, which low relative to estimates of whole-stream denitrification derived from LINX2 isotope tracer studies [@Mulholland:2008cj]. This finding seems reasonable given that NO$_3^{-}$ concentrations were low at Nyack; this river drains mostly wilderness with little human land use except for scattered riverside residences upstream and an highway and train line running along the south valley wall. Most studies of denitrification occur in areas with high fluxes and rates [@Reisinger:2016kq] because of the relevance of knowin how much natural ecosysytems mitigate the effect of high levels of N pollution, and for the simpler fact that denitrification fluxes are easier to measure when they are large. Despite the low rate of 0.1 d$^{-1}$ another way to consider is that the residence time of a NO$_3^{-}$ molecule is 10 d in the aquifer, which is shorter that the residence time of much of the water there suggesting ample time for denitrification to remove much of the in inputs

The future for this work is to measure the extent to which denitrification in the floodplain attenuates downstream fluxes of NO$_3^{-}$ in the Middle Fork Flathead River (or any other river). Rates of water flow between the river and the floodplain are high with 30% of the river water exchanging during the 10 km flooplain length, thus there is much potential for floodplain dentrification to lower downstream fluxes. As a thought experiment, we can estimate daily denitrification in the entire floodplain (10 km $\times$ 2 km) at 9000 mol/d. Downstream flux during baseflow (28 m$^3$ s$^{-1}$) and 4 $\mu$mol NO$_3^{-}$ L$^{-1}$ is 10,000 mol N/d, which says that the amount of NO$_3^{-}$ permanently removed by the Nyack floodplain is similar to the downstream transport during the biologically active, low-flow time of year. This question merits further investigation; we can test it by combining the residence time distribution models developed by Poole for this report with highly resolved NO$_3^{-}$ budgets for the for the Nyack reach of the Middle Fork Flathead.

## References


